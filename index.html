<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Anschlussförderung - Dashboard</title>
  <style>
    body{
      font-family: Arial, sans-serif;
      text-align:center;
      margin:0; padding:20px;
      transition: background-color 0.5s ease-in-out;
      background: linear-gradient(180deg, #4CAF50, #388E3C);
      color:#fff;
    }
    h1{ font-size:24px; font-weight:bold; text-transform:uppercase; margin-bottom:10px; }
    #clock{
      font-size:24px; font-weight:bold;
      background: rgba(255,255,255,0.2);
      padding:10px; border-radius:8px; display:inline-block; margin-bottom:15px;
      box-shadow:0 4px 8px rgba(0,0,0,0.2);
    }
    .box{
      background: rgba(255,255,255,0.15);
      padding:15px; margin:10px auto; border-radius:12px;
      box-shadow:0 6px 12px rgba(0,0,0,0.3);
      max-width:90%; text-align:center;
      backdrop-filter: blur(8px);
      transition: transform 0.3s ease-in-out;
    }
    .box:hover{ transform: scale(1.02); }
    .hidden{ display:none; }
    .left-align{ text-align:left; padding-left:15px; font-size:16px; }
    .countdown{ font-size:20px; font-weight:bold; margin-top:10px; }
    @media (max-width:600px){
      h1{ font-size:20px; }
      #clock{ font-size:20px; padding:8px; }
      .box{ padding:12px; }
      .left-align{ font-size:14px; padding-left:10px; }
      .countdown{ font-size:18px; }
    }
    #footer{ margin-top:20px; font-size:14px; opacity:0.8; }
  </style>
</head>
<body id="pageBody">
  <div class="box">
    <h1 id="mainTitle">Keine Anschlussförderung ✅</h1>
    <p id="dayDisplay"></p>
  </div>

  <div id="clock">--:--:--</div>

  <div class="box hidden" id="groupInfoBox">
    <h3 id="groupTitle"></h3>
    <div id="groupInfo"></div>
    <p class="countdown hidden" id="countdown"></p>
  </div>

  <audio id="alertSound" src="https://www.soundjay.com/button/beep-07.wav"></audio>

  <script>
    // ---------------------------
    // Daten: 2 Gruppen (neu)
    // Wochentage: So=0, Mo=1, Di=2, Mi=3, Do=4, Fr=5, Sa=6
    // Zeiten im Format HH:MM
    // ---------------------------
    const schedule = [
      {
        teacher: "Team 1", group: "1",
        times: [
          { day: 2, start: "09:50", end: "11:20" }, // Dienstag 3./4.
          { day: 3, start: "09:50", end: "11:20" }, // Mittwoch 3./4.
          { day: 3, start: "11:40", end: "13:10" }, // Mittwoch 5./6.
          { day: 4, start: "11:40", end: "13:10" }, // Donnerstag 5./6.
          { day: 5, start: "07:40", end: "09:30" }, // Freitag 1./2.
          { day: 5, start: "11:40", end: "13:10" }  // Freitag 5./6.
        ],
        students: [
          "Mohammed A. (8.1)", "Evelina (8.1)", "Mohammed H. (8.1)", "Veysel (8.1)",
          "Amar (8.2)", "Blind (8.2)", "Beyar (8.2)", "Ili (8.2)", "Altin (8.1)"
        ]
      },
      {
        teacher: "Team 2", group: "2",
        times: [
          { day: 1, start: "09:50", end: "11:20" }, // Montag 3./4.
          { day: 2, start: "07:40", end: "09:30" }, // Dienstag 1./2.
          { day: 5, start: "09:50", end: "11:20" }  // Freitag 3./4.
        ],
        students: [
          "Bahar (8a)", "Violetta (8a)", "Justina (8a)", "Stasia (8a)",
          "Arzoo (8.1)", "Emma (8.1)", "Zelal (8.2)", "Ilyas (8.2)"
        ]
      }
    ];

    const dayNames = ["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"];

    let lastFiveMinuteAlertKey = null; // verhindert Mehrfach-Alarm

    function updateClock(){
      document.getElementById("clock").innerText = new Date().toLocaleTimeString("de-DE");
    }

    function updateDisplay(){
      const now = new Date();
      document.getElementById("dayDisplay").innerText =
        `${dayNames[now.getDay()]}, ${now.toLocaleDateString("de-DE")}`;

      const today = now.getDay();
      let activeSession = null;
      const futureSessions = [];

      // Aktive und zukünftige (heutige) Sessions sammeln
      schedule.forEach(group => {
        group.times.forEach(time => {
          if (time.day !== today) return;

          const [sH,sM] = time.start.split(":").map(Number);
          const [eH,eM] = time.end.split(":").map(Number);

          const sessionStart = new Date(now);
          const sessionEnd   = new Date(now);
          sessionStart.setHours(sH, sM, 0, 0);
          sessionEnd.setHours(eH, eM, 0, 0);

          if (now >= sessionStart && now <= sessionEnd) {
            activeSession = {
              teacher: group.teacher, group: group.group,
              students: group.students, start: sessionStart, end: sessionEnd
            };
          } else if (sessionStart > now) {
            futureSessions.push({
              teacher: group.teacher, group: group.group,
              students: group.students, time: sessionStart, end: sessionEnd
            });
          }
        });
      });

      futureSessions.sort((a,b) => a.time - b.time);
      const nextSession = futureSessions.length ? futureSessions[0] : null;

      const title = document.getElementById("mainTitle");
      const groupInfoBox = document.getElementById("groupInfoBox");
      const groupTitle = document.getElementById("groupTitle");
      const groupInfo = document.getElementById("groupInfo");
      const countdown = document.getElementById("countdown");

      if (activeSession){
        document.body.style.background = "linear-gradient(180deg, #D32F2F, #B71C1C)";
        title.innerText = "Anschlussförderung aktiv ❌";
        groupTitle.innerText = `Gruppe ${activeSession.group} (${activeSession.teacher})`;
        groupInfo.innerHTML = `<p class="left-align">${activeSession.students.join("<br>")}</p>`;
        countdown.classList.add("hidden");
        groupInfoBox.classList.remove("hidden");
      } else if (nextSession){
        const diffMs   = nextSession.time - now;
        const minutes  = Math.floor(diffMs / 60000);
        const seconds  = Math.floor((diffMs % 60000) / 1000);

        document.body.style.background = "linear-gradient(180deg, #FFD700, #FFA500)";
        title.innerText = "Achtung! Gleich Anschlussförderung ⚠️";
        groupTitle.innerText = `Gruppe ${nextSession.group} (${nextSession.teacher})`;
        groupInfo.innerHTML = `<p class="left-align">${nextSession.students.join("<br>")}</p>`;

        countdown.innerText = minutes > 0
          ? `Startet in ${minutes} Minute${minutes===1?"":"n"}`
          : `Startet in ${seconds} Sekunde${seconds===1?"":"n"}`;
        countdown.classList.remove("hidden");
        groupInfoBox.classList.remove("hidden");

        // 5-Minuten-Warnung (nur einmal je Session-Startzeit)
        if (minutes === 5){
          const alertKey = nextSession.time.toISOString().slice(0,16); // bis Minute genau
          if (lastFiveMinuteAlertKey !== alertKey){
            lastFiveMinuteAlertKey = alertKey;
            const audio = document.getElementById("alertSound");
            audio.play().catch(()=>{/* Autoplay evtl. blockiert – stiller Fallback */});
          }
        }
      } else {
        document.body.style.background = "linear-gradient(180deg, #4CAF50, #388E3C)";
        title.innerText = "Keine Anschlussförderung ✅";
        groupInfoBox.classList.add("hidden");
        countdown.classList.add("hidden");
      }
    }

    // Start: Uhr und Anzeige sofort setzen, dann Intervalle
    updateClock();
    updateDisplay();

    // Uhr jede Sekunde
    setInterval(updateClock, 1000);

    // Anzeige: jede Sekunde (präziser Countdown & zuverlässige Statuswechsel)
    setInterval(updateDisplay, 1000);
  </script>

  <p id="footer">(Stand: 22.08.2025)</p>
</body>
</html>
